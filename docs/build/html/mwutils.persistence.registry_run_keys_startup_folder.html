<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; mwutils 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="mwutils.privilege_escalation package" href="mwutils.privilege_escalation.html" />
    <link rel="prev" title="mwutils.persistence package" href="mwutils.persistence.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            mwutils
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="README.html">About the Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Logging.html">Logging</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">mwutils</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="mwutils.html">mwutils package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="mwutils.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="mwutils.collection.html">mwutils.collection package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.command_and_control.html">mwutils.command_and_control package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.credential_access.html">mwutils.credential_access package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.defense_evasion.html">mwutils.defense_evasion package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.discovery.html">mwutils.discovery package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.execution.html">mwutils.execution package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.exfiltration.html">mwutils.exfiltration package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.gui.html">mwutils.gui package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.impact.html">mwutils.impact package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.initial_access.html">mwutils.initial_access package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.lateral_movement.html">mwutils.lateral_movement package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="mwutils.persistence.html">mwutils.persistence package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.privilege_escalation.html">mwutils.privilege_escalation package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.reconnaissance.html">mwutils.reconnaissance package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.resource_development.html">mwutils.resource_development package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.server.html">mwutils.server package</a></li>
<li class="toctree-l4"><a class="reference internal" href="mwutils.utils.html">mwutils.utils package</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mwutils</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">mwutils</a></li>
          <li class="breadcrumb-item"><a href="mwutils.html">mwutils package</a></li>
          <li class="breadcrumb-item"><a href="mwutils.persistence.html">mwutils.persistence package</a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/mwutils.persistence.registry_run_keys_startup_folder.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <span class="target" id="module-mwutils.persistence.registry_run_keys_startup_folder"></span><p>Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder</p>
<p>Adversaries may achieve persistence by adding a program to a startup folder or referencing it
with a Registry run key.
Adding an entry to the “run keys” in the Registry or startup folder will cause the program
referenced to be executed when a user logs in.
These programs will be executed under the context of the user and will have the
account’s associated permissions level.</p>
<p>Placing a program within a startup folder will also cause that program to execute when
a user logs in.
There is a startup folder location for individual user accounts as well as a system-wide
startup folder that will be checked regardless of which user account logs in.
The startup folder path for the current user is
<cite>C:Users[Username]AppDataRoamingMicrosoftWindowsStart MenuProgramsStartup</cite>.
The startup folder path for all users is
<cite>C:ProgramDataMicrosoftWindowsStart MenuProgramsStartUp</cite>.</p>
<p>The following run keys are created by default on Windows systems:</p>
<ul class="simple">
<li><p><cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRun</cite></p></li>
<li><p><cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRunOnce</cite></p></li>
<li><p><cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRun</cite></p></li>
<li><p><cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunOnce</cite></p></li>
</ul>
<p>Run keys may exist under multiple hives.
The <cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunOnceEx</cite>
is also available but is not created by default on Windows Vista and newer.
Registry run key entries can reference programs directly or list them as a dependency.
For example, it is possible to load a DLL at logon using a “Depend” key with RunOnceEx:
<cite>reg add HKLMSOFTWAREMicrosoftWindowsCurrentVersionRunOnceEx0001Depend /v 1 /d “C:tempevil[.]dll”</cite></p>
<p>The following Registry keys can be used to set startup folder items for persistence:</p>
<ul class="simple">
<li><p><cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunServicesOnce</cite></p></li>
<li><p><cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRunServicesOnce</cite></p></li>
<li><p><cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRunServices</cite></p></li>
<li><p><cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRunServices</cite></p></li>
</ul>
<p>Using policy settings to specify startup programs creates corresponding values in either of
two Registry keys:</p>
<ul class="simple">
<li><p><cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionPoliciesExplorerRun</cite></p></li>
<li><p><cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionPoliciesExplorerRun</cite></p></li>
</ul>
<p>The Winlogon key controls actions that occur when a user logs on to a computer running Windows 7.
Most of these actions are under the control of the operating system, but you can also
add custom actions here.
The <cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindows NTCurrentVersionWinlogonUserinit</cite>
and <cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindows NTCurrentVersionWinlogonShell</cite>
subkeys can automatically launch programs.</p>
<p>Programs listed in the load value of the registry key
<cite>HKEY_CURRENT_USERSoftwareMicrosoftWindows NTCurrentVersionWindows</cite>
run when any user logs on.</p>
<p>By default, the multistring BootExecute value of the registry key
<cite>HKEY_LOCAL_MACHINESystemCurrentControlSetControlSession Manager</cite>
is set to <cite>autocheck autochk *</cite>.
This value causes Windows, at startup, to check the file-system integrity of the
hard disks if the system has been shut down abnormally.
Adversaries can add other programs or processes to this registry value which will
automatically launch at boot.</p>
<p>Adversaries can use these configuration locations to execute malware, such as
remote access tools, to maintain persistence through system reboots.
Adversaries may also use Masquerading to make the Registry entries look as if they
are associated with legitimate programs.</p>
<p>Mitre: <a class="reference external" href="https://attack.mitre.org/techniques/T1547/">T1547.001</a></p>
<dl class="py function">
<dt class="sig sig-object py" id="mwutils.persistence.registry_run_keys_startup_folder.add_registry_entry">
<span class="sig-name descname"><span class="pre">add_registry_entry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keyname</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valuename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="_modules/mwutils/persistence/registry_run_keys_startup_folder.html#add_registry_entry"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mwutils.persistence.registry_run_keys_startup_folder.add_registry_entry" title="Permalink to this definition"></a></dt>
<dd><p>Adds a entry to the registry.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>keyname</strong> (<em>str</em>) – The key where the valuename is added to.</p></li>
<li><p><strong>valuename</strong> (<em>str</em>) – The name of the entry.</p></li>
<li><p><strong>command</strong> (<em>str</em>) – The data for the entry.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output of the command.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mwutils.persistence.registry_run_keys_startup_folder.persist_via_HKCU_key">
<span class="sig-name descname"><span class="pre">persist_via_HKCU_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">valuename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="_modules/mwutils/persistence/registry_run_keys_startup_folder.html#persist_via_HKCU_key"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mwutils.persistence.registry_run_keys_startup_folder.persist_via_HKCU_key" title="Permalink to this definition"></a></dt>
<dd><p>Adds a entry to the registry.</p>
<p>The command is the value added to the entry.</p>
<p>Registry key: <cite>HKEY_CURRENT_USERSoftwareMicrosoftWindowsCurrentVersionRun</cite></p>
<p class="rubric">Example</p>
<p>persist_via_registry(“Update”, r”run.exe”)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valuename</strong> (<em>str</em>) – The name of the entry.</p></li>
<li><p><strong>command</strong> (<em>str</em>) – The data of the entry.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output of the command.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mwutils.persistence.registry_run_keys_startup_folder.persist_via_HKLM_key">
<span class="sig-name descname"><span class="pre">persist_via_HKLM_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">valuename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">command</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="reference internal" href="_modules/mwutils/persistence/registry_run_keys_startup_folder.html#persist_via_HKLM_key"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mwutils.persistence.registry_run_keys_startup_folder.persist_via_HKLM_key" title="Permalink to this definition"></a></dt>
<dd><p>Adds a entry to the registry.</p>
<p>The command is the value added to the entry.</p>
<p>Registry key: <cite>HKEY_LOCAL_MACHINESoftwareMicrosoftWindowsCurrentVersionRun</cite></p>
<p class="rubric">Example</p>
<p>persist_via_registry(“Update”, r”run.exe”)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>valuename</strong> (<em>str</em>) – The name of the entry.</p></li>
<li><p><strong>command</strong> (<em>str</em>) – The data of the entry.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output of the command.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="mwutils.persistence.html" class="btn btn-neutral float-left" title="mwutils.persistence package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="mwutils.privilege_escalation.html" class="btn btn-neutral float-right" title="mwutils.privilege_escalation package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, wenzelfe.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>